generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id               String            @id @default(uuid())
  fullName         String
  email            String            @unique
  password         String
  role             String            @default("STUDENT")
  avatar           String?
  bio              String?
  isVerified       Boolean           @default(false)
  isBlocked        Boolean           @default(false)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  universityId     String?
  adminActions     AdminAction[]     @relation("AdminActions")
  actionsReceived  AdminAction[]     @relation("TargetUser")
  messagesReceived Message[]         @relation("ReceivedMessages")
  messagesSent     Message[]         @relation("SentMessages")
  notifications    Notification[]
  properties       Property[]        @relation("AgentProperties")
  roommateRequests RoommateRequest[]
  transactions     Transaction[]
  university       University?       @relation(fields: [universityId], references: [id])

  @@index([email])
  @@index([role])
  @@index([universityId])
  @@map("users")
}

model University {
  id         String     @id @default(uuid())
  name       String     @unique
  state      String
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  properties Property[]
  users      User[]

  @@map("universities")
}

model Property {
  id               String            @id @default(uuid())
  agentId          String
  title            String
  description      String
  price            Float
  location         String
  campus           String
  universityId     String?
  category         String
  images           String
  bedrooms         Int
  bathrooms        Int
  roommatesAllowed Boolean           @default(false)
  isAvailable      Boolean           @default(true)
  rooms            Int               @default(1)
  status           String            @default("PENDING")
  views            Int               @default(0)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  agent            User              @relation("AgentProperties", fields: [agentId], references: [id], onDelete: Cascade)
  university       University?       @relation(fields: [universityId], references: [id])
  roommateRequests RoommateRequest[]
  transactions     Transaction[]

  @@index([agentId])
  @@index([universityId])
  @@index([category])
  @@index([isAvailable])
  @@map("properties")
}

model RoommateRequest {
  id         String    @id @default(uuid())
  userId     String
  propertyId String?
  budget     Float?
  roomType   String?
  genderPref String?
  bio        String?
  houseLink  String?
  media      String?
  status     String    @default("PENDING")
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  property   Property? @relation(fields: [propertyId], references: [id])
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([propertyId])
  @@index([status])
  @@map("roommate_requests")
}

model Message {
  id         String   @id @default(uuid())
  senderId   String
  receiverId String
  message    String
  isRead     Boolean  @default(false)
  createdAt  DateTime @default(now())
  receiver   User     @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)
  sender     User     @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([receiverId])
  @@index([createdAt])
  @@map("messages")
}

model AdminAction {
  id           String   @id @default(uuid())
  adminId      String
  actionType   String
  targetUserId String?
  description  String
  createdAt    DateTime @default(now())
  admin        User     @relation("AdminActions", fields: [adminId], references: [id], onDelete: Cascade)
  targetUser   User?    @relation("TargetUser", fields: [targetUserId], references: [id])

  @@index([adminId])
  @@index([actionType])
  @@index([createdAt])
  @@map("admin_actions")
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  title     String
  message   String
  type      String   @default("SYSTEM")
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
  @@map("notifications")
}

model Transaction {
  id         String    @id @default(uuid())
  userId     String
  propertyId String?
  amount     Float
  currency   String    @default("NGN")
  status     String    @default("PENDING")
  reference  String    @unique
  provider   String    @default("PAYSTACK")
  type       String    @default("RENT")
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  property   Property? @relation(fields: [propertyId], references: [id])
  user       User      @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([reference])
  @@map("transactions")
}
